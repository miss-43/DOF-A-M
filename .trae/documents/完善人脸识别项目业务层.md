# 完善人脸识别项目业务层

## 1. 项目结构设计
- **face_recognition_main.cpp**：核心人脸识别逻辑实现
- **app.cpp**：与LVGL前端的接口层
- **app.h**：接口头文件，定义接口函数

## 2. 实现步骤

### 2.1 创建app.h和app.cpp文件
- 定义与LVGL前端交互的接口函数
- 实现人脸检测、识别、训练等功能的封装

### 2.2 完善face_recognition_main.cpp
#### 2.2.1 数据库交互模块
- 实现与SQLite数据库的连接
- 读取t_Employee表的Employee_ID作为employee_id
- 读取t_Face表的Face_ID作为labels

#### 2.2.2 图像采集与处理模块
- 实现人脸检测功能，使用跳帧策略
- 对检测到的人脸进行灰度化、直方图均衡化处理
- 按固定尺寸裁剪人脸图像
- 存储处理后的图像到指定目录结构

#### 2.2.3 模型训练与导入模块
- 检查src/data/models目录下是否存在训练好的.yml模型
- 若存在则导入模型，否则不导入
- 实现模型训练功能，训练完成后存储到指定目录

#### 2.2.4 人脸识别模块
- 使用训练好的模型进行人脸识别
- 将识别结果（工号）返回给LVGL前端

#### 2.2.5 日志管理模块
- 实现统一的错误/日志输出函数
- 支持按错误码输出不同的报错信息

#### 2.2.6 LVGL接口集成
- 替换原有键盘退出逻辑
- 实现LVGL返回按钮可调用的退出接口

### 2.3 代码优化与注释
- 为每一步代码添加详细的中文注释
- 确保代码结构清晰，便于维护

## 3. 关键技术点
- **OpenCV**：人脸检测、图像处理、模型训练与识别
- **SQLite**：数据库交互
- **LVGL**：前端接口集成
- **跳帧策略**：提高性能，减少资源消耗
- **统一日志管理**：便于调试和维护

## 4. 预期效果
- 实现完整的人脸识别功能
- 与LVGL前端无缝集成
- 支持图像采集、模型训练和人脸识别
- 具备良好的错误处理和日志管理
- 代码结构清晰，易于维护和扩展